<!DOCTYPE html>
<html lang="en" data-version="1.0.13">

<head>
    <!-- Mobile Detection: Redirect phone users to mobile-optimized version -->
    <script>
        (function () {
            // Skip if user explicitly chose desktop version
            if (localStorage.getItem('eurokeys_prefer_desktop') === 'true') return;

            // Detect mobile: screen width OR mobile user agent
            const isMobile = window.innerWidth <= 768 ||
                /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            if (isMobile && !window.location.pathname.includes('mobile_v2')) {
                // Show choice modal instead of auto-redirect
                document.addEventListener('DOMContentLoaded', function () {
                    const banner = document.createElement('div');
                    banner.id = 'mobileBanner';
                    banner.innerHTML = `
                        <div style="position:fixed;top:0;left:0;right:0;z-index:10000;background:linear-gradient(135deg,#10b981,#34d399);padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;box-shadow:0 4px 20px rgba(0,0,0,0.3);">
                            <span style="color:#000;font-weight:600;font-size:0.9rem;">üì± Try our new mobile app!</span>
                            <div style="display:flex;gap:8px;">
                                <button onclick="window.location.href='mobile_v2.html'" style="background:#000;color:#10b981;border:none;padding:8px 16px;border-radius:20px;font-weight:700;font-size:0.8rem;cursor:pointer;">Open App</button>
                                <button onclick="localStorage.setItem('eurokeys_prefer_desktop','true');document.getElementById('mobileBanner').remove();" style="background:transparent;color:#000;border:1px solid #000;padding:8px 12px;border-radius:20px;font-weight:600;font-size:0.8rem;cursor:pointer;">‚úï</button>
                            </div>
                        </div>
                    `;
                    document.body.prepend(banner);
                });
            }
        })();
    </script>
    <!-- v1.0.4 - Restored InventoryManager.getAllKeys functionality -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Euro Keys">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="apple-touch-icon" href="/assets/icon-192.png">
    <title>Euro Keys - Locksmith Database</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css?v=1767214510">
</head>

<body>

    <!-- FCC Detail Modal -->
    <div id="fccModal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeFccModal()"></div>
        <div class="modal-content">
            <button class="modal-close" onclick="closeFccModal()">√ó</button>
            <div id="fccModalBody"></div>
        </div>
    </div>

    <!-- Key Photos Modal -->
    <div id="keyPhotosModal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeKeyPhotosModal()"></div>
        <div class="modal-content" style="max-width: 700px;">
            <button class="modal-close" onclick="closeKeyPhotosModal()">√ó</button>
            <div id="keyPhotosModalBody"></div>
        </div>
    </div>

    <!-- Lightbox for enlarged photos -->
    <div id="photoLightbox" onclick="closeLightbox()"
        style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; align-items: center; justify-content: center; cursor: zoom-out;">
        <img id="lightboxImage" style="max-width: 95%; max-height: 95%; object-fit: contain;">
    </div>

    <!-- Job Logging Modal -->
    <div id="jobLogModal" class="job-modal-overlay" onclick="if(event.target === this) closeJobModal()">
        <div class="job-modal" style="max-width: 520px;">
            <div class="job-modal-header">
                <h3>üìã Log Job & Calculate Profit</h3>
                <button class="job-modal-close" onclick="closeJobModal()">√ó</button>
            </div>
            <div class="job-modal-body">
                <div class="job-item-preview" id="jobItemPreview">
                    <div class="item-name" id="jobItemName">Item Name</div>
                    <div class="item-vehicle" id="jobItemVehicle"></div>
                </div>

                <form id="jobLogForm" onsubmit="submitJobLog(event)">
                    <input type="hidden" id="jobItemKey" />
                    <input type="hidden" id="jobItemType" />
                    <input type="hidden" id="jobDisplayTitle" />

                    <!-- Customer & Vehicle Selection -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div class="job-form-group">
                            <label for="jobCustomer">Customer (Optional)</label>
                            <input type="text" id="jobCustomer" placeholder="John Smith" />
                        </div>
                        <div class="job-form-group">
                            <label for="jobVehicleSelect">Select Vehicle</label>
                            <select id="jobVehicleSelect"
                                onchange="document.getElementById('jobDescription').value = this.value; calculateJobProfit();"
                                style="width: 100%; border-radius: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); padding: 8px; font-size: 0.85rem;">
                                <option value="">-- Choose Car --</option>
                            </select>
                        </div>
                    </div>

                    <div class="job-form-group" style="margin-top: 8px;">
                        <label for="jobDescription">Job Description / Custom Vehicle</label>
                        <input type="text" id="jobDescription" placeholder="e.g. 2018 Toyota Camry" />
                    </div>

                    <!-- Revenue Section -->
                    <div
                        style="background: rgba(34, 197, 94, 0.1); padding: 12px; border-radius: 8px; margin: 12px 0; border: 1px solid rgba(34, 197, 94, 0.2);">
                        <div
                            style="font-size: 0.75rem; color: #4ade80; text-transform: uppercase; font-weight: 700; margin-bottom: 8px;">
                            üíµ Revenue</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div class="job-form-group" style="margin: 0;">
                                <label for="jobRevenue">Service Charged ($)</label>
                                <input type="number" id="jobRevenue" placeholder="150.00" step="0.01"
                                    oninput="calculateJobProfit()" />
                            </div>
                            <div class="job-form-group" style="margin: 0;">
                                <label for="jobTip">Tip ($)</label>
                                <input type="number" id="jobTip" placeholder="0.00" step="0.01" value="0"
                                    oninput="calculateJobProfit()" />
                            </div>
                        </div>
                    </div>

                    <!-- Costs Section -->
                    <div
                        style="background: rgba(239, 68, 68, 0.1); padding: 12px; border-radius: 8px; margin: 12px 0; border: 1px solid rgba(239, 68, 68, 0.2);">
                        <div
                            style="font-size: 0.75rem; color: #f87171; text-transform: uppercase; font-weight: 700; margin-bottom: 8px;">
                            üìâ Costs</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                            <div class="job-form-group" style="margin: 0;">
                                <label for="itemCost">Key Cost ($)</label>
                                <input type="number" id="itemCost" placeholder="35.00" step="0.01"
                                    oninput="calculateJobProfit()" />
                            </div>
                            <div class="job-form-group" style="margin: 0;">
                                <label for="jobMiles">Miles Driven</label>
                                <input type="number" id="jobMiles" placeholder="15" step="0.1"
                                    oninput="calculateJobProfit()" />
                            </div>
                            <div class="job-form-group" style="margin: 0;">
                                <label for="jobTimeMinutes">Time (min)</label>
                                <input type="number" id="jobTimeMinutes" placeholder="45" step="1"
                                    oninput="calculateJobProfit()" />
                            </div>
                        </div>
                    </div>

                    <!-- Profit Summary (Live Calculation) -->
                    <div id="profitSummary"
                        style="background: linear-gradient(135deg, #1e1e1e, #252525); padding: 16px; border-radius: 8px; margin: 12px 0; border: 1px solid #333;">
                        <div
                            style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; text-align: center;">
                            <div>
                                <div style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">
                                    Gross</div>
                                <div id="calcGross" style="font-size: 1.1rem; font-weight: 700; color: #4ade80;">$0.00
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">
                                    Expenses</div>
                                <div id="calcExpenses" style="font-size: 1.1rem; font-weight: 700; color: #f87171;">
                                    $0.00</div>
                            </div>
                            <div>
                                <div style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">
                                    Net Profit</div>
                                <div id="calcProfit"
                                    style="font-size: 1.1rem; font-weight: 700; color: var(--brand-primary);">$0.00
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase;">
                                    $/Hour</div>
                                <div id="calcHourly" style="font-size: 1.1rem; font-weight: 700; color: #60a5fa;">$0.00
                                </div>
                            </div>
                        </div>
                        <div
                            style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #333; display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted);">
                            <span>Est. Tax (30%): <span id="calcTax" style="color: #fbbf24;">$0.00</span></span>
                            <span>Mileage: <span id="calcMileage" style="color: #a78bfa;">$0.00</span> @ $0.67/mi</span>
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="job-form-group">
                        <label for="jobNotes">Notes (Optional)</label>
                        <textarea id="jobNotes" placeholder="Any details..." style="height: 50px;"></textarea>
                    </div>

                    <div class="job-form-group"
                        style="display: flex; align-items: center; gap: 12px; background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                        <input type="checkbox" id="jobConsumeStock" checked
                            style="width: 20px; height: 20px; accent-color: var(--brand-primary);">
                        <label for="jobConsumeStock" style="margin: 0; cursor: pointer;">Consume 1 Inventory
                            Item</label>
                    </div>

                    <div class="job-modal-actions">
                        <button type="button" class="btn-cancel-job" onclick="closeJobModal()">Cancel</button>
                        <button type="submit" class="btn-save-job">‚úì Log Job & Use Item</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeDeleteConfirmModal()"></div>
        <div class="modal-content" style="max-width: 400px; text-align: center; padding: 32px;">
            <div style="font-size: 3rem; margin-bottom: 16px;">üóëÔ∏è</div>
            <h3 style="margin-bottom: 12px; color: var(--text-primary);">Delete Item?</h3>
            <p style="color: var(--text-secondary); margin-bottom: 24px;">Are you sure you want to remove this item from
                your inventory? This action cannot be undone.</p>
            <div style="display: flex; gap: 12px; justify-content: center;">
                <button onclick="closeDeleteConfirmModal()"
                    style="padding: 10px 24px; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 8px; cursor: pointer; font-weight: 600;">Cancel</button>
                <button onclick="confirmDelete()"
                    style="padding: 10px 24px; background: #ef4444; border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Upgrade to Pro Modal -->
    <div id="upgradeModal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeUpgradeModal()"></div>
        <div class="modal-content" style="max-width: 900px; padding: 0;">
            <button class="modal-close" onclick="closeUpgradeModal()" style="z-index: 10;">√ó</button>

            <div class="upgrade-modal-layout">
                <!-- Header / Value Prop -->
                <div
                    style="background: linear-gradient(135deg, #1e293b, #0f172a); padding: 40px; text-align: center; border-radius: 12px 12px 0 0;">
                    <h2
                        style="font-size: 2rem; margin-bottom: 12px; background: linear-gradient(90deg, #fbbf24, #f59e0b); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                        Upgrade to Euro Keys Pro
                    </h2>
                    <p style="color: #94a3b8; font-size: 1.1rem; max-width: 600px; margin: 0 auto;">
                        Stop guessing on the job. Get full inventory control, offline access features, and priority
                        updates.
                    </p>
                </div>

                <!-- Pricing Cards -->
                <div style="padding: 40px; background: var(--bg-secondary);">

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 24px;">

                        <!-- Monthly -->
                        <div class="price-card"
                            style="background: var(--bg-tertiary); padding: 24px; border-radius: 12px; border: 1px solid var(--border); position: relative;">
                            <h3 style="color: var(--text-primary); margin-bottom: 8px;">Monthly</h3>
                            <div
                                style="font-size: 2rem; font-weight: 700; color: var(--text-primary); margin-bottom: 16px;">
                                $9.99<span
                                    style="font-size: 1rem; color: var(--text-muted); font-weight: 400;">/mo</span>
                            </div>
                            <ul
                                style="list-style: none; padding: 0; margin-bottom: 24px; color: var(--text-secondary);">
                                <li style="margin-bottom: 8px;">‚úì Full Inventory Management</li>
                                <li style="margin-bottom: 8px;">‚úì Stock Alerts</li>
                                <li style="margin-bottom: 8px;">‚úì Priority Support</li>
                            </ul>
                            <button onclick="startCheckout('monthly', event)"
                                style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--brand-primary); color: var(--brand-primary); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                                Start Monthly
                            </button>
                        </div>

                        <!-- Annual (Best Value) -->
                        <div class="price-card"
                            style="background: #1e293b; padding: 24px; border-radius: 12px; border: 2px solid #fbbf24; position: relative; transform: scale(1.05); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);">
                            <div
                                style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #fbbf24; color: #000; padding: 4px 12px; border-radius: 12px; font-size: 0.8rem; font-weight: 700;">
                                MOST POPULAR
                            </div>
                            <h3 style="color: white; margin-bottom: 8px;">Annual</h3>
                            <div style="font-size: 2rem; font-weight: 700; color: white; margin-bottom: 4px;">
                                $99<span style="font-size: 1rem; color: #94a3b8; font-weight: 400;">/yr</span>
                            </div>
                            <div style="color: #fbbf24; font-size: 0.85rem; margin-bottom: 16px;">Save ~17% vs
                                Monthly</div>
                            <ul style="list-style: none; padding: 0; margin-bottom: 24px; color: #e2e8f0;">
                                <li style="margin-bottom: 8px;">‚úì Full Inventory Management</li>
                                <li style="margin-bottom: 8px;">‚úì Stock Alerts</li>
                                <li style="margin-bottom: 8px;">‚úì Priority Support</li>
                                <li style="margin-bottom: 8px;">‚úì 2 Months Free</li>
                            </ul>
                            <button onclick="startCheckout('annual', event)"
                                style="width: 100%; padding: 12px; background: #fbbf24; border: none; color: #000; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.2s;">
                                Get Annual Plan
                            </button>
                        </div>

                        <!-- Lifetime -->
                        <div class="price-card"
                            style="background: var(--bg-tertiary); padding: 24px; border-radius: 12px; border: 1px solid var(--border);">
                            <h3 style="color: var(--text-primary); margin-bottom: 8px;">Lifetime</h3>
                            <div
                                style="font-size: 2rem; font-weight: 700; color: var(--text-primary); margin-bottom: 16px;">
                                $249
                            </div>
                            <ul
                                style="list-style: none; padding: 0; margin-bottom: 24px; color: var(--text-secondary);">
                                <li style="margin-bottom: 8px;">‚úì One-time payment</li>
                                <li style="margin-bottom: 8px;">‚úì All Pro Features Forever</li>
                                <li style="margin-bottom: 8px;">‚úì No Recurring Fees</li>
                            </ul>
                            <button onclick="startCheckout('lifetime', event)"
                                style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--text-muted); color: var(--text-primary); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                                Buy Lifetime
                            </button>
                        </div>

                    </div>

                    <div style="text-align: center; margin-top: 24px; color: var(--text-muted); font-size: 0.9rem;">
                        Secure payment processing via Stripe.
                        <a href="#" onclick="restorePurchases(); return false;"
                            style="color: var(--text-secondary); text-decoration: underline;">Restore Purchases</a>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="top-bar">üìû Call (804) 506-0709</div>

    <header class="header">
        <div class="logo">üîë EURO <span>KEYS</span></div>
        <div class="header-right">
            <!-- Quick Search Toggle -->
            <div class="header-search-container">
                <button class="header-search-toggle" onclick="toggleHeaderSearch()" title="Quick Search">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                </button>
                <div id="headerSearchBox" class="header-search-box" style="display: none;">
                    <input type="text" id="headerSearchInput" placeholder="Search FCC ID, make, model..."
                        onkeypress="if(event.key==='Enter') headerQuickSearch()">
                    <button onclick="headerQuickSearch()">Go</button>
                    <button onclick="toggleHeaderSearch()" class="close-search">√ó</button>
                </div>
            </div>

            <!-- User menu shows when signed in -->
            <div id="userMenu" style="display: none; align-items: center; gap: 12px;">
                <button id="headerUpgradeBtn" onclick="startCheckout('monthly', event)" style="
                    background: linear-gradient(135deg, #fbbf24, #f59e0b);
                    border: none;
                    color: #000;
                    padding: 6px 12px;
                    border-radius: 20px;
                    font-weight: 700;
                    font-size: 0.8rem;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 4px;
                    box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
                ">
                    <span style="font-size: 1rem;">üëë</span> Upgrade
                </button>
                <div class="user-menu-container">
                    <span class="user-name" id="userName"
                        style="font-weight: 600; color: var(--text-primary); cursor: pointer;"
                        onclick="toggleUserMenu()"></span>
                    <div class="header-avatar" id="userAvatar" onclick="toggleUserMenu()" style="cursor: pointer;">
                    </div>

                    <div id="userDropdown" class="user-dropdown">
                        <div style="padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <div id="dropdownUserName"
                                style="font-weight: 700; color: var(--text-primary); font-size: 0.85rem;">User</div>
                            <div id="dropdownUserEmail"
                                style="font-size: 0.75rem; color: var(--text-muted); overflow: hidden; text-overflow: ellipsis;">
                            </div>
                        </div>
                        <button class="user-dropdown-item" onclick="showTab('inventory')">
                            <span>üì¶</span> My Inventory
                        </button>
                        <div id="devMenuOption" style="display: none;">
                            <button class="user-dropdown-item" onclick="showTab('dev')">
                                <span>üõ†Ô∏è</span> Dev Panel
                            </button>
                        </div>
                        <div class="user-dropdown-divider"></div>
                        <button class="user-dropdown-item logout" onclick="signOut()">
                            <span>üö™</span> Sign Out
                        </button>
                    </div>
                </div>
            </div>
            <!-- Google Sign In button shows when signed out -->
            <button id="googleSignInBtn" class="google-signin-btn" onclick="signInWithGoogle()" style="display: flex;">
                <svg viewBox="0 0 24 24">
                    <path fill="#4285F4"
                        d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                    <path fill="#34A853"
                        d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                    <path fill="#FBBC05"
                        d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                    <path fill="#EA4335"
                        d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                </svg>
                Sign in
            </button>
        </div>
    </header>

    <!-- Tabs -->
    <div class="tabs" id="mainTabs">
        <button class="tab active" onclick="showTab('browse')">üìÇ Browse Database</button>
        <button class="tab" id="fccTab" onclick="showTab('fcc')">üì° FCC Database</button>
        <button class="tab" id="guidesTab" onclick="showTab('guides')">üìñ Guides</button>
        <button class="tab" id="inventoryTab" onclick="showTab('inventory')" style="display: none;">üì¶ My
            Inventory</button>
        <button class="tab" id="devTab" onclick="showTab('dev')" style="display: none;">üõ†Ô∏è Dev Panel</button>
        <button class="tab" id="subscriptionsTab" onclick="showTab('subscriptions')" style="display: none;">üìÖ
            Subscriptions</button>
    </div>

    <!-- BROWSE DATABASE TAB -->
    <div id="browse" class="tab-view active">

        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="hero-title">Browse Database</h1>
            <p class="hero-subtitle">Access professional locksmith data, programming guides, and part numbers.</p>

            <div id="modelSearchUI">
                <div class="omni-search-container">
                    <i class="fas fa-search omni-search-icon"></i>
                    <input type="text" class="omni-search-input" id="omniSearch"
                        placeholder="Search by Year/Make/Model/VIN..." onkeyup="handleOmniSearch(event)">
                    <button class="omni-scan-btn" onclick="startVinCamera()" title="Scan VIN">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>
                <div id="vinError"
                    style="color: #ef4444; font-size: 0.85rem; margin-top: -30px; margin-bottom: 20px; text-align: center; display: none;">
                </div>
            </div>

            <!-- Pre-calculate results list if needed -->
            <div id="vinLoading" style="display: none; text-align: center; padding: 40px;">
                <div class="loader" style="margin: 0 auto;"></div>
                <p style="margin-top: 16px; color: var(--text-secondary);">Decoding VIN...</p>
            </div>
        </div>

        <!-- Visual Make Selector (Brand Grid) -->
        <div id="visualMakeSelector" style="padding: 0 20px 40px;">
            <h3 style="text-align: center; margin-bottom: 24px; color: var(--text-muted); font-weight: 600;">Or Select a
                Make</h3>
            <div class="make-grid" id="makeGrid">
                <!-- Populated by renderMakeGrid() -->
            </div>
        </div>

        <!-- Drill Down / Selection Card -->
        <div class="card" id="legacySearchCard" style="display: none; max-width: 800px; margin: 0 auto;">

            <!-- Compact Header -->
            <div id="selectedVehicleDisplay"
                style="display: none; border-bottom: 1px solid var(--border); padding-bottom: 16px; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <img id="selectedMakeLogo" src="" style="width: 48px; height: 48px; object-fit: contain;">
                        <div id="selectedMakeAvatar" class="text-avatar" style="display: none; margin: 0;"></div>
                        <div>
                            <h2 id="selectedMakeName" style="margin: 0; font-size: 1.5rem; line-height: 1.2;"></h2>
                            <button onclick="showMakeDropdown()"
                                style="background: none; border: none; padding: 0; color: var(--text-muted); font-size: 0.85rem; cursor: pointer; text-decoration: underline;">Change
                                Make</button>
                            <!-- Quick Make Dropdown (inline) -->
                            <select id="quickMakeDropdown" onchange="quickChangeMake(this.value)"
                                style="display: none; margin-left: 10px; padding: 4px 8px; border-radius: 4px; background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border);">
                                <option value="">Select Make...</option>
                            </select>
                        </div>
                    </div>
                    <!-- Optional: Selected Year Badge -->
                    <div id="selectedYearBadge"
                        style="display: none; background: var(--bg-tertiary); padding: 4px 12px; border-radius: 20px; font-weight: 700; color: var(--brand-primary); border: 1px solid var(--border);">
                    </div>
                </div>
            </div>

            <!-- Step 2: Select Year -->
            <div id="yearChipsContainer" style="display: none;">
                <h3 style="font-size: 1.1rem; margin-bottom: 16px; color: var(--text-secondary);">Select Year</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;" id="yearChips"></div>
            </div>

            <!-- Step 3: Select Model (Visual) -->
            <div id="modelChipsContainer" style="display: none; margin-top: 24px;">
                <h3 style="font-size: 1.1rem; margin-bottom: 16px; color: var(--text-secondary);">Select Model</h3>
                <div class="model-filter-bar" id="modelFilterBar" style="display: none;">
                    <button class="model-filter-btn active" onclick="filterModels('all')">All</button>
                </div>
                <div class="model-grid" id="modelChips"></div>
                <div id="modelLoading"
                    style="display: none; color: var(--text-muted); padding: 20px; text-align: center;">Loading
                    models...</div>
            </div>

            <!-- Legacy Form (Hidden state holder) -->
            <div class="form-group-row" style="display: none;">
                <div class="form-group">
                    <label>YEAR</label>
                    <select id="yearSelect" onchange="loadMakes()">
                        <option value="">Select Year</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>MAKE</label>
                    <select id="makeSelect" onchange="loadModels()">
                        <option value="">Select Make</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>MODEL</label>
                    <select id="modelSelect" disabled onchange="searchVehicle()">
                        <option value="">Select Model</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Loader -->
        <div class="loader" id="loader"></div>

        <!-- Results -->
        <div id="results"></div>
    </div>
    <div id="resultsSection" class="results-section">
        <div class="container">
            <div class="result-header">
                <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 12px;">
                    <h2 class="result-title" id="resultTitle" style="margin: 0;">Vehicle Results</h2>
                    <div class="year-nav" id="yearNavigation" style="display: none;">
                        <button class="year-nav-btn" id="yearPrevBtn" onclick="navigateYear(-1)"
                            title="Previous Year">‚Üê</button>
                        <span class="year-nav-current" id="yearNavCurrent">2023</span>
                        <button class="year-nav-btn" id="yearNextBtn" onclick="navigateYear(1)"
                            title="Next Year">‚Üí</button>
                    </div>
                </div>
                <div class="result-actions">
                    <button class="back-btn" onclick="goBack()">üîç New Search</button>
                </div>
            </div>

            <!-- Quick vehicle switcher -->
            <div class="quick-search" style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap;">
                <select class="browse-select" id="quickYear" onchange="quickLoadMakes()"
                    style="padding: 10px 14px; font-size: 0.9rem; flex: 1; min-width: 100px;">
                    <option value="">Year</option>
                </select>
                <select class="browse-select" id="quickMake" onchange="quickLoadModels()"
                    style="padding: 10px 14px; font-size: 0.9rem; flex: 1; min-width: 120px;">
                    <option value="">Make</option>
                </select>
                <select class="browse-select" id="quickModel"
                    style="padding: 10px 14px; font-size: 0.9rem; flex: 1; min-width: 120px;">
                    <option value="">Model</option>
                </select>
                <button onclick="quickSearch()"
                    style="padding: 10px 16px; background: var(--brand-primary); border: none; border-radius: 8px; color: var(--bg-primary); font-weight: 600; cursor: pointer; white-space: nowrap;">Go
                    ‚Üí</button>
            </div>

            <div id="resultsContainer"></div>
        </div>
    </div>
    </div>

    <!-- FCC Database Tab -->
    <div class="tab-content" id="tabFcc">
        <div class="container">
            <div class="page-title">
                <h1>Key <span>Database</span> & Coverage</h1>
            </div>
            <p class="page-subtitle">Browse FCC IDs for key fobs and remotes with direct Amazon links.</p>

            <div class="fcc-filters" style="flex-wrap: wrap;">
                <button class="fcc-filter active" data-type="all" onclick="setFccFilter('all')">All Keys</button>
                <button class="fcc-filter" data-type="smart" onclick="setFccFilter('smart')">üöó Smart/Prox</button>
                <button class="fcc-filter" data-type="transponder" onclick="setFccFilter('transponder')">üè∑Ô∏è
                    Transponder</button>
                <button class="fcc-filter" data-type="remote-head" onclick="setFccFilter('remote-head')">üîë Remote
                    Head</button>
                <button class="fcc-filter" data-type="flip" onclick="setFccFilter('flip')">üîÑ Flip Key</button>
                <button class="fcc-filter" data-type="mechanical" onclick="setFccFilter('mechanical')">üóùÔ∏è
                    Mechanical</button>

                <!-- Year filters hidden/moved if desired, or kept here -->
            </div>

            <!-- KEY DATABASE HEADER & HEATMAP CONTAINER -->
            <div id="keyCoverageContainer" style="margin-bottom: 24px;">
                <!-- Heatmap injected by renderKeyCoverageMap() -->
            </div>

            <div class="fcc-search" style="margin-top: 20px;">
                <input type="text" id="fccSearch" placeholder="üîç Search keys... (e.g. 'Honda Civic 2018', 'HYQ12BDM')"
                    oninput="filterFccTable()">
            </div>

            <div class="fcc-table-wrapper">
                <table class="fcc-table">
                    <thead>
                        <tr>
                            <th>FCC ID</th>
                            <th>OEM Part #</th>
                            <th>Vehicles</th>
                            <th class="hide-mobile">Frequency</th>
                            <th class="hide-mobile">Chip</th>
                            <th>Stock</th>
                            <th>Amazon</th>
                        </tr>
                    </thead>
                    <tbody id="fccTableBody">
                        <tr>
                            <td colspan="7" class="loading">Loading FCC data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Mobile-first cards view -->
            <div class="fcc-cards" id="fccCards">
                <div class="loading" style="text-align: center; padding: 40px; color: var(--text-muted);">
                    Loading
                    FCC
                    data...</div>
            </div>

            <div class="pagination" id="fccPagination"></div>
        </div>
    </div>

    <!-- Guides Tab -->
    <div class="tab-content" id="tabGuides" style="display: none;">
        <div class="container">
            <div class="page-title">
                <h1>üìñ Programming <span>Guides</span></h1>
            </div>
            <p class="page-subtitle">Comprehensive guides for every make for key programming procedures.</p>

            <!-- Guides Search and Filters -->
            <div class="fcc-filters" style="flex-wrap: wrap; margin-bottom: 20px;">
                <button class="fcc-filter active" data-make="all" onclick="filterGuidesByMake('all')">All Makes</button>
                <button class="fcc-filter" data-make="chevrolet"
                    onclick="filterGuidesByMake('chevrolet')">Chevrolet/GM</button>
                <button class="fcc-filter" data-make="mercedes-benz"
                    onclick="filterGuidesByMake('mercedes-benz')">Mercedes-Benz</button>
                <button class="fcc-filter" data-make="audi" onclick="filterGuidesByMake('audi')">Audi/VW</button>
                <button class="fcc-filter" data-make="bmw" onclick="filterGuidesByMake('bmw')">BMW</button>
                <button class="fcc-filter" data-make="toyota" onclick="filterGuidesByMake('toyota')">Toyota</button>
                <button class="fcc-filter" data-make="honda" onclick="filterGuidesByMake('honda')">Honda</button>
                <button class="fcc-filter" data-make="ford" onclick="filterGuidesByMake('ford')">Ford</button>
                <button class="fcc-filter" data-make="stellantis"
                    onclick="filterGuidesByMake('stellantis')">Stellantis</button>
                <button class="fcc-filter" data-make="land rover"
                    onclick="filterGuidesByMake('land rover')">JLR</button>
                <button class="fcc-filter" data-make="mazda" onclick="filterGuidesByMake('mazda')">Mazda</button>
                <button class="fcc-filter" data-make="volvo" onclick="filterGuidesByMake('volvo')">Volvo</button>
            </div>

            <div class="fcc-search" style="margin-bottom: 20px;">
                <input type="text" id="guidesSearch"
                    placeholder="üîç Search guides... (e.g. 'E-Class FBS4', 'Camry H chip')"
                    oninput="filterGuidesTable()">
            </div>

            <!-- Guide Stats -->
            <div id="guideStats" style="display: flex; gap: 16px; margin-bottom: 24px; flex-wrap: wrap;">
                <div class="stat-card"
                    style="flex: 1; min-width: 150px; background: var(--bg-tertiary); padding: 16px; border-radius: 12px; border: 1px solid var(--border);">
                    <div style="font-size: 2rem; font-weight: 700; color: var(--brand-primary);" id="totalGuidesCount">
                        --</div>
                    <div style="color: var(--text-muted); font-size: 0.85rem;">Total Guides</div>
                </div>
                <div class="stat-card"
                    style="flex: 1; min-width: 150px; background: var(--bg-tertiary); padding: 16px; border-radius: 12px; border: 1px solid var(--border);">
                    <div style="font-size: 2rem; font-weight: 700; color: #22c55e;" id="uniqueMakesCount">--</div>
                    <div style="color: var(--text-muted); font-size: 0.85rem;">Makes Covered</div>
                </div>
                <div class="stat-card"
                    style="flex: 1; min-width: 150px; background: var(--bg-tertiary); padding: 16px; border-radius: 12px; border: 1px solid var(--border);">
                    <div style="font-size: 2rem; font-weight: 700; color: #f59e0b;" id="dealerOnlyCount">--</div>
                    <div style="color: var(--text-muted); font-size: 0.85rem;">Dealer-Only</div>
                </div>
            </div>

            <!-- Guides Grid -->
            <div id="guidesGrid"
                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px;">
                <div class="loading"
                    style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-muted);">
                    Loading guides...
                </div>
            </div>
        </div>
    </div>



    <!-- Camera Scanner Modal -->
    <div id="vinCameraModal"
        style="display: none; margin-top: 16px; padding: 16px; background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <span style="font-weight: 600; color: var(--text-primary);">üì∑ VIN Camera Scanner</span>
            <button onclick="stopVinCamera()"
                style="background: #ef4444; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">Close
                ‚úï</button>
        </div>
        <video id="vinCameraVideo" style="width: 100%; max-height: 300px; border-radius: 8px; background: #000;"
            autoplay playsinline></video>
        <div style="margin-top: 12px; text-align: center;">
            <button onclick="captureVinFrame(event)" class="search-btn" style="padding: 10px 24px;">üì∏
                Capture &
                Scan</button>
        </div>
        <canvas id="vinCameraCanvas" style="display: none;"></canvas>
        <div id="vinScanResult"
            style="margin-top: 12px; display: none; padding: 12px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border: 1px solid #22c55e;">
            <span style="color: #22c55e; font-weight: 600;">Detected VIN: </span>
            <span id="vinDetectedText"
                style="font-family: monospace; letter-spacing: 2px; color: var(--text-primary);"></span>
            <button onclick="useDetectedVin()"
                style="margin-left: 12px; background: #22c55e; color: white; border: none; padding: 4px 12px; border-radius: 4px; cursor: pointer;">Use
                This</button>
        </div>
    </div>
    </div>

    <!-- VIN Results Section -->
    <div id="vinResults" style="display: none;">
        <!-- Vehicle Info Banner -->
        <div id="vinVehicleInfo"
            style="background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary)); padding: 20px 24px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 24px;">
        </div>

        <!-- Key Parts Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">

            <!-- Key Blank Section -->
            <div class="vin-result-card"
                style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px; border: 1px solid var(--border);">
                <div
                    style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border);">
                    <span style="font-size: 1.5rem;">üîë</span>
                    <h3 style="margin: 0; color: var(--brand-primary);">Key Blank</h3>
                </div>
                <div id="vinKeyBlank" class="vin-data-grid"></div>
            </div>

            <!-- Transponder Section -->
            <div class="vin-result-card"
                style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px; border: 1px solid var(--border);">
                <div
                    style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border);">
                    <span style="font-size: 1.5rem;">üè∑Ô∏è</span>
                    <h3 style="margin: 0; color: var(--brand-primary);">Transponder / Chip</h3>
                </div>
                <div id="vinTransponder" class="vin-data-grid"></div>
            </div>

            <!-- Remote / FOB Section -->
            <div class="vin-result-card"
                style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px; border: 1px solid var(--border);">
                <div
                    style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border);">
                    <span style="font-size: 1.5rem;">üì°</span>
                    <h3 style="margin: 0; color: var(--brand-primary);">Remote / Key Fob</h3>
                </div>
                <div id="vinRemote" class="vin-data-grid"></div>
            </div>

            <!-- Programming Section -->
            <div class="vin-result-card"
                style="background: var(--bg-tertiary); border-radius: 12px; padding: 20px; border: 1px solid var(--border);">
                <div
                    style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border);">
                    <span style="font-size: 1.5rem;">üõ†Ô∏è</span>
                    <h3 style="margin: 0; color: var(--brand-primary);">Programming Info</h3>
                </div>
                <div id="vinProgramming" class="vin-data-grid"></div>
            </div>
        </div>

        <!-- Buy Links Section -->
        <div id="vinBuyLinks"
            style="margin-top: 24px; background: linear-gradient(135deg, #1a472a, #2d5a3f); border-radius: 12px; padding: 20px; border: 1px solid #3d7a5a;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
                <span style="font-size: 1.5rem;">üõí</span>
                <h3 style="margin: 0; color: #4ade80;">Buy Parts on Amazon</h3>
            </div>
            <div id="vinAmazonLinks" style="display: flex; gap: 12px; flex-wrap: wrap;"></div>
        </div>
    </div>

    <!-- Loading State -->
    <div id="vinLoading" style="display: none; text-align: center; padding: 60px; color: var(--text-muted);">
        <div style="font-size: 2rem; margin-bottom: 12px;">üîÑ</div>
        <div>Decoding VIN...</div>
    </div>
    </div>
    </div>

    <!-- Developer Panel Tab (only visible to developers) -->
    <div class="tab-content" id="tabDev" style="display: none;">
        <div class="container">
            <div class="page-title">
                <h1>üõ†Ô∏è Developer <span>Panel</span></h1>
            </div>
            <p class="page-subtitle">User analytics and activity tracking dashboard.</p>

            <!-- Global Error Banner (Hidden by default) -->
            <div id="devGlobalError"
                style="display: none; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 12px; padding: 16px; margin-top: 24px; align-items: center; gap: 12px; color: #f87171;">
                <span style="font-size: 1.2rem;">‚ö†Ô∏è</span>
                <div style="flex: 1;">
                    <div style="font-weight: 700; font-size: 0.9rem;">Data Stream Interrupted</div>
                    <div id="devGlobalErrorMsg" style="font-size: 0.8rem; opacity: 0.9;">Unable to reach the analytics
                        engine. Please ensure you are logged in.</div>
                </div>
                <button onclick="loadDevPanel()"
                    style="background: rgba(239, 68, 68, 0.2); border: none; color: white; padding: 6px 16px; border-radius: 8px; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.2s;">Retry</button>
            </div>

            <!-- High-Impact KPIs (1 Million Dollar Business Analytics) -->
            <div id="devKpis"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 24px;">
                <div
                    style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05)); border-radius: 20px; padding: 24px; border: 1px solid rgba(59, 130, 246, 0.2); box-shadow: 0 8px 32px rgba(0,0,0,0.2);">
                    <div
                        style="color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        Total Platform Users</div>
                    <div style="font-size: 2.5rem; font-weight: 850; color: #60a5fa; line-height: 1;"
                        id="devTotalUsers">-</div>
                    <div style="margin-top: 12px; font-size: 0.8rem; color: #4ade80;">‚Üë <span
                            id="devUserGrowth">0</span>% vs last 30d</div>
                </div>
                <div
                    style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.05)); border-radius: 20px; padding: 24px; border: 1px solid rgba(245, 158, 11, 0.2); box-shadow: 0 8px 32px rgba(0,0,0,0.2);">
                    <div
                        style="color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        Est. Monthly Revenue</div>
                    <div style="font-size: 2.5rem; font-weight: 850; color: #fbbf24; line-height: 1;"
                        id="devEstRevenue">$0.00</div>
                    <div style="margin-top: 12px; font-size: 0.8rem; color: var(--text-muted);">Based on $1.50/click avg
                    </div>
                </div>
                <div
                    style="background: linear-gradient(135deg, rgba(34, 211, 238, 0.1), rgba(8, 145, 178, 0.05)); border-radius: 20px; padding: 24px; border: 1px solid rgba(34, 211, 238, 0.2); box-shadow: 0 8px 32px rgba(0,0,0,0.2);">
                    <div
                        style="color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        Conversion Rate (CVR)</div>
                    <div style="font-size: 2.5rem; font-weight: 850; color: #22d3ee; line-height: 1;"
                        id="devConversionRate">0.0%</div>
                    <div style="margin-top: 12px; font-size: 0.8rem; color: #4ade80;">Search ‚Üí Click</div>
                </div>
                <div
                    style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(147, 51, 234, 0.05)); border-radius: 20px; padding: 24px; border: 1px solid rgba(168, 85, 247, 0.2); box-shadow: 0 8px 32px rgba(0,0,0,0.2);">
                    <div
                        style="color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        Active Engagement</div>
                    <div style="font-size: 2.5rem; font-weight: 850; color: #c084fc; line-height: 1;"
                        id="devAvgEngagement">0.0</div>
                    <div style="margin-top: 12px; font-size: 0.8rem; color: var(--text-muted);">Avg. interactions per
                        guest</div>
                </div>
            </div>

            <!-- Cloudflare Traffic Analytics with Persona Tabs -->
            <div style="margin-top: 32px;">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
                    <h3 style="color: var(--text-primary); display: flex; align-items: center; gap: 10px; margin: 0;">
                        <span>‚òÅÔ∏è</span> Cloudflare Traffic
                        <span
                            style="font-size: 0.7rem; background: rgba(249, 115, 22, 0.2); color: #f97316; padding: 4px 10px; border-radius: 100px; font-weight: 600;">LIVE</span>
                    </h3>
                    <div id="cfPersonaTabs" style="display: flex; gap: 6px;">
                        <button class="cf-persona-tab active" data-tab="overview" onclick="setCfPersonaTab('overview')"
                            style="background: rgba(249,115,22,0.2); border: 1px solid rgba(249,115,22,0.3); color: #f97316; padding: 6px 14px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: 600;">
                            üìä Overview
                        </button>
                        <button class="cf-persona-tab" data-tab="tech" onclick="setCfPersonaTab('tech')"
                            style="background: rgba(96,165,250,0.1); border: 1px solid rgba(96,165,250,0.2); color: #60a5fa; padding: 6px 14px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: 600; opacity: 0.7;">
                            üîß Tech
                        </button>
                        <button class="cf-persona-tab" data-tab="marketing" onclick="setCfPersonaTab('marketing')"
                            style="background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.2); color: #22c55e; padding: 6px 14px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: 600; opacity: 0.7;">
                            üì¢ Marketing
                        </button>
                    </div>
                </div>

                <!-- Overview Tab Content (Default) -->
                <div id="cfTabOverview" class="cf-tab-content">
                    <div id="cfAnalyticsContainer"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px;">
                        <div
                            style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(194, 65, 12, 0.05)); border-radius: 16px; padding: 20px; border: 1px solid rgba(249, 115, 22, 0.2);">
                            <div
                                style="color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
                                Unique Visitors (24h)</div>
                            <div style="font-size: 2rem; font-weight: 850; color: #f97316;" id="cfVisitors24h">--</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;"><span
                                    id="cfVisitors7d">--</span> (7d)</div>
                        </div>
                        <div
                            style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(22, 163, 74, 0.05)); border-radius: 16px; padding: 20px; border: 1px solid rgba(34, 197, 94, 0.2);">
                            <div
                                style="color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
                                Total Requests (24h)</div>
                            <div style="font-size: 2rem; font-weight: 850; color: #22c55e;" id="cfRequests24h">--</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;"><span
                                    id="cfRequests7d">--</span> (7d)</div>
                        </div>
                        <div
                            style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(124, 58, 237, 0.05)); border-radius: 16px; padding: 20px; border: 1px solid rgba(139, 92, 246, 0.2);">
                            <div
                                style="color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
                                Data Served (24h)</div>
                            <div style="font-size: 2rem; font-weight: 850; color: #8b5cf6;" id="cfData24h">--</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;"><span
                                    id="cfData7d">--</span> (7d)</div>
                        </div>
                        <div
                            style="background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(8, 145, 178, 0.05)); border-radius: 16px; padding: 20px; border: 1px solid rgba(6, 182, 212, 0.2);">
                            <div
                                style="color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
                                Cache Hit Rate</div>
                            <div style="font-size: 2rem; font-weight: 850; color: #06b6d4;" id="cfCacheRate24h">--</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;"><span
                                    id="cfCacheRate7d">--</span> (7d)</div>
                        </div>
                    </div>
                </div>

                <!-- Tech Tab Content -->
                <div id="cfTabTech" class="cf-tab-content" style="display: none;">
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                        <div
                            style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05)); border-radius: 16px; padding: 20px; border: 1px solid rgba(239, 68, 68, 0.2);">
                            <div
                                style="color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 6px;">
                                Error Rate (7d)</div>
                            <div style="font-size: 2rem; font-weight: 850; color: #ef4444;" id="cfErrorRate">0.00%</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">4xx + 5xx
                                responses</div>
                        </div>
                        <div
                            style="background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(8, 145, 178, 0.05)); border-radius: 16px; padding: 20px; border: 1px solid rgba(6, 182, 212, 0.2);">
                            <div
                                style="color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 6px;">
                                Cache Rate (7d)</div>
                            <div style="font-size: 2rem; font-weight: 850; color: #06b6d4;" id="cfCacheRateTech">--
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">Served from edge
                            </div>
                        </div>
                        <div
                            style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.05)); border-radius: 16px; padding: 20px; border: 1px solid rgba(251, 191, 36, 0.2);">
                            <div
                                style="color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 6px;">
                                Threats Blocked (7d)</div>
                            <div style="font-size: 2rem; font-weight: 850; color: #fbbf24;" id="cfThreats">0</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">Security
                                incidents</div>
                        </div>
                    </div>
                    <!-- Status Code Breakdown -->
                    <div
                        style="background: var(--glass-bg); border-radius: 16px; padding: 20px; border: 1px solid var(--glass-border);">
                        <div style="color: var(--text-primary); font-weight: 700; margin-bottom: 16px;">Response Status
                            Codes (7d)</div>
                        <div id="cfStatusBars" style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="width: 40px; color: #4ade80; font-weight: 600;">2xx</span>
                                <div
                                    style="flex: 1; height: 20px; background: rgba(255,255,255,0.05); border-radius: 4px; overflow: hidden;">
                                    <div id="cfStatus2xx"
                                        style="width: 0%; height: 100%; background: #4ade80; transition: width 0.5s;">
                                    </div>
                                </div>
                                <span id="cfStatus2xxPct"
                                    style="width: 50px; text-align: right; color: var(--text-muted); font-size: 0.85rem;">0%</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="width: 40px; color: #60a5fa; font-weight: 600;">3xx</span>
                                <div
                                    style="flex: 1; height: 20px; background: rgba(255,255,255,0.05); border-radius: 4px; overflow: hidden;">
                                    <div id="cfStatus3xx"
                                        style="width: 0%; height: 100%; background: #60a5fa; transition: width 0.5s;">
                                    </div>
                                </div>
                                <span id="cfStatus3xxPct"
                                    style="width: 50px; text-align: right; color: var(--text-muted); font-size: 0.85rem;">0%</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="width: 40px; color: #fbbf24; font-weight: 600;">4xx</span>
                                <div
                                    style="flex: 1; height: 20px; background: rgba(255,255,255,0.05); border-radius: 4px; overflow: hidden;">
                                    <div id="cfStatus4xx"
                                        style="width: 0%; height: 100%; background: #fbbf24; transition: width 0.5s;">
                                    </div>
                                </div>
                                <span id="cfStatus4xxPct"
                                    style="width: 50px; text-align: right; color: var(--text-muted); font-size: 0.85rem;">0%</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="width: 40px; color: #ef4444; font-weight: 600;">5xx</span>
                                <div
                                    style="flex: 1; height: 20px; background: rgba(255,255,255,0.05); border-radius: 4px; overflow: hidden;">
                                    <div id="cfStatus5xx"
                                        style="width: 0%; height: 100%; background: #ef4444; transition: width 0.5s;">
                                    </div>
                                </div>
                                <span id="cfStatus5xxPct"
                                    style="width: 50px; text-align: right; color: var(--text-muted); font-size: 0.85rem;">0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Security Details -->
                    <div
                        style="background: var(--glass-bg); border-radius: 16px; padding: 20px; border: 1px solid var(--glass-border); margin-top: 20px;">
                        <div
                            style="color: var(--text-primary); font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                            üõ°Ô∏è Security Events (7d)
                        </div>
                        <div id="cfSecurityList" style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="color: var(--text-muted); font-size: 0.85rem;">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- Marketing Tab Content -->
                <div id="cfTabMarketing" class="cf-tab-content" style="display: none;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                        <!-- Top Countries -->
                        <div
                            style="background: var(--glass-bg); border-radius: 16px; padding: 20px; border: 1px solid var(--glass-border);">
                            <div
                                style="color: var(--text-primary); font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                üåç Top Countries (7d)
                            </div>
                            <div id="cfCountriesList" style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="color: var(--text-muted); font-size: 0.85rem;">Loading...</div>
                            </div>
                        </div>
                        <!-- Device Breakdown -->
                        <div
                            style="background: var(--glass-bg); border-radius: 16px; padding: 20px; border: 1px solid var(--glass-border);">
                            <div
                                style="color: var(--text-primary); font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                üì± Devices (7d)
                            </div>
                            <div id="cfDevicesList" style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="color: var(--text-muted); font-size: 0.85rem;">Loading...</div>
                            </div>
                        </div>
                        <!-- Browser Breakdown -->
                        <div
                            style="background: var(--glass-bg); border-radius: 16px; padding: 20px; border: 1px solid var(--glass-border);">
                            <div
                                style="color: var(--text-primary); font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                üåê Browsers (7d)
                            </div>
                            <div id="cfBrowsersList" style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="color: var(--text-muted); font-size: 0.85rem;">Loading...</div>
                            </div>
                        </div>
                        <!-- Top Content -->
                        <div
                            style="background: var(--glass-bg); border-radius: 16px; padding: 20px; border: 1px solid var(--glass-border);">
                            <div
                                style="color: var(--text-primary); font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                üìÑ Top Content (7d)
                            </div>
                            <div id="cfPathsList" style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="color: var(--text-muted); font-size: 0.85rem;">Loading...</div>
                            </div>
                        </div>
                        <!-- Referrers -->
                        <div
                            style="background: var(--glass-bg); border-radius: 16px; padding: 20px; border: 1px solid var(--glass-border);">
                            <div
                                style="color: var(--text-primary); font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                üîó Referrers (7d)
                            </div>
                            <div id="cfReferrersList" style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="color: var(--text-muted); font-size: 0.85rem;">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="cfConfigMessage"
                    style="display: none; text-align: center; padding: 24px; color: var(--text-muted); font-size: 0.9rem;">
                    <div style="font-size: 1.5rem; margin-bottom: 8px;">üîß</div>
                    <span id="cfConfigText">Configure CF_ANALYTICS_TOKEN and CF_ZONE_ID to enable Cloudflare
                        analytics</span>
                </div>
            </div>

            <!-- Conversion Funnel & AI Insight -->
            <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 24px; margin-top: 32px;">
                <!-- Funnel -->
                <div
                    style="background: var(--glass-bg); border-radius: 20px; border: 1px solid var(--glass-border); padding: 24px;">
                    <h3
                        style="color: var(--text-primary); margin-bottom: 24px; display: flex; align-items: center; gap: 10px;">
                        <span>üå™Ô∏è</span> Acquisition Funnel
                    </h3>
                    <div style="display: flex; flex-direction: column; gap: 24px;">
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: var(--text-secondary); font-size: 0.9rem;">Total Searches</span>
                                <span id="funnelSearchCount"
                                    style="color: var(--text-primary); font-weight: 700;">0</span>
                            </div>
                            <div
                                style="height: 12px; background: rgba(255,255,255,0.05); border-radius: 6px; overflow: hidden;">
                                <div id="funnelSearchProgress"
                                    style="width: 100%; height: 100%; background: #60a5fa; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);">
                                </div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: var(--text-secondary); font-size: 0.9rem;">VIN Lookups</span>
                                <span id="funnelVinCount" style="color: var(--text-primary); font-weight: 700;">0</span>
                            </div>
                            <div
                                style="height: 12px; background: rgba(255,255,255,0.05); border-radius: 6px; overflow: hidden;">
                                <div id="funnelVinProgress"
                                    style="width: 0%; height: 100%; background: #22d3ee; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);">
                                </div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: var(--text-secondary); font-size: 0.9rem;">Affiliate Clicks</span>
                                <span id="funnelClickCount"
                                    style="color: var(--text-primary); font-weight: 700;">0</span>
                            </div>
                            <div
                                style="height: 12px; background: rgba(255,255,255,0.05); border-radius: 6px; overflow: hidden;">
                                <div id="funnelClickProgress"
                                    style="width: 0%; height: 100%; background: #fbbf24; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Insights -->
                <div
                    style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05)); border-radius: 20px; border: 1px solid rgba(16, 185, 129, 0.2); padding: 24px;">
                    <h3
                        style="color: var(--text-primary); margin-bottom: 16px; display: flex; align-items: center; gap: 10px;">
                        <span>üß†</span> Business Intelligence
                    </h3>
                    <div id="devAiInsights" style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">
                        <p>Analyzing platform data for market trends...</p>
                    </div>
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 8px;">Top Trending
                            Model:</div>
                        <div id="devTrendingModel" style="font-size: 1.1rem; color: #34d399; font-weight: 700;">Finding
                            trends...</div>
                    </div>
                </div>
            </div>

            <!-- Detailed Metrics Grid -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-top: 32px;">
                <!-- Top Searches -->
                <div
                    style="background: var(--glass-bg); border-radius: 20px; border: 1px solid var(--glass-border); padding: 24px;">
                    <h3
                        style="color: var(--text-primary); margin-bottom: 20px; font-size: 1rem; display: flex; align-items: center; gap: 8px;">
                        <span>üîç</span> Top Search Terms
                    </h3>
                    <div id="devTopSearches" style="display: flex; flex-direction: column; gap: 10px;">
                        <div style="color: var(--text-muted); text-align: center; padding: 20px;">No searches tracked
                            yet</div>
                    </div>
                </div>

                <!-- VIN Lookups -->
                <div
                    style="background: var(--glass-bg); border-radius: 20px; border: 1px solid var(--glass-border); padding: 24px;">
                    <h3
                        style="color: var(--text-primary); margin-bottom: 20px; font-size: 1rem; display: flex; align-items: center; gap: 8px;">
                        <span>üöó</span> Top VIN Lookups
                    </h3>
                    <div id="devVinLookups" style="display: flex; flex-direction: column; gap: 10px;">
                        <div style="color: var(--text-muted); text-align: center; padding: 20px;">No VIN lookups yet
                        </div>
                    </div>
                </div>

                <!-- Tab Usage -->
                <div
                    style="background: var(--glass-bg); border-radius: 20px; border: 1px solid var(--glass-border); padding: 24px;">
                    <h3
                        style="color: var(--text-primary); margin-bottom: 20px; font-size: 1rem; display: flex; align-items: center; gap: 8px;">
                        <span>üìä</span> Tab Engagement
                    </h3>
                    <div id="devTabUsage" style="display: flex; flex-direction: column; gap: 10px;">
                        <div style="color: var(--text-muted); text-align: center; padding: 20px;">No engagement data yet
                        </div>
                    </div>
                </div>
            </div>


            <!-- Users Table -->
            <div style="margin-top: 32px;">
                <h3 style="color: var(--text-primary); margin-bottom: 16px;">üë• Registered Users</h3>
                <div
                    style="background: var(--glass-bg); border-radius: 16px; border: 1px solid var(--glass-border); overflow: hidden;">
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: rgba(255,255,255,0.03);">
                                    <th
                                        style="padding: 12px 16px; text-align: left; color: var(--text-muted); font-weight: 600; font-size: 0.85rem;">
                                        User</th>
                                    <th
                                        style="padding: 12px 16px; text-align: left; color: var(--text-muted); font-weight: 600; font-size: 0.85rem;">
                                        Email</th>
                                    <th
                                        style="padding: 12px 16px; text-align: center; color: var(--text-muted); font-weight: 600; font-size: 0.85rem;">
                                        Status</th>
                                    <th
                                        style="padding: 12px 16px; text-align: center; color: var(--text-muted); font-weight: 600; font-size: 0.85rem;">
                                        Activities</th>
                                    <th
                                        style="padding: 12px 16px; text-align: left; color: var(--text-muted); font-weight: 600; font-size: 0.85rem;">
                                        Signed Up</th>
                                    <th
                                        style="padding: 12px 16px; text-align: left; color: var(--text-muted); font-weight: 600; font-size: 0.85rem;">
                                        Last Active</th>
                                </tr>
                            </thead>
                            <tbody id="devUsersTable">
                                <tr>
                                    <td colspan="6"
                                        style="padding: 40px; text-align: center; color: var(--text-muted);">Loading
                                        users...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Activity Log with Category Tabs -->
            <div style="margin-top: 32px;">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px;">
                    <h3 style="color: var(--text-primary); margin: 0;">üìä Recent Activity</h3>
                    <div id="activityCategoryTabs" style="display: flex; gap: 6px; flex-wrap: wrap;">
                        <button class="activity-tab active" data-category="all" onclick="setActivityTab('all')"
                            style="background: rgba(96,165,250,0.2); border: 1px solid rgba(96,165,250,0.3); color: #60a5fa; padding: 6px 12px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: 600;">
                            All <span id="activityCountAll" style="opacity: 0.7; margin-left: 4px;">0</span>
                        </button>
                        <button class="activity-tab" data-category="job_logging" onclick="setActivityTab('job_logging')"
                            style="background: rgba(251,191,36,0.1); border: 1px solid rgba(251,191,36,0.2); color: #fbbf24; padding: 6px 12px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: 600;">
                            üîß Jobs <span id="activityCountJobs" style="opacity: 0.7; margin-left: 4px;">0</span>
                        </button>
                        <button class="activity-tab" data-category="search" onclick="setActivityTab('search')"
                            style="background: rgba(34,211,238,0.1); border: 1px solid rgba(34,211,238,0.2); color: #22d3ee; padding: 6px 12px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: 600;">
                            üîç Search <span id="activityCountSearch" style="opacity: 0.7; margin-left: 4px;">0</span>
                        </button>
                        <button class="activity-tab" data-category="monetization"
                            onclick="setActivityTab('monetization')"
                            style="background: rgba(74,222,128,0.1); border: 1px solid rgba(74,222,128,0.2); color: #4ade80; padding: 6px 12px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: 600;">
                            üí∞ Revenue <span id="activityCountRevenue" style="opacity: 0.7; margin-left: 4px;">0</span>
                        </button>
                        <button class="activity-tab" data-category="browsing" onclick="setActivityTab('browsing')"
                            style="background: rgba(168,85,247,0.1); border: 1px solid rgba(168,85,247,0.2); color: #a855f7; padding: 6px 12px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: 600;">
                            üì± Browse <span id="activityCountBrowse" style="opacity: 0.7; margin-left: 4px;">0</span>
                        </button>
                        <button class="activity-tab" data-category="session" onclick="setActivityTab('session')"
                            style="background: rgba(148,163,184,0.1); border: 1px solid rgba(148,163,184,0.2); color: #94a3b8; padding: 6px 12px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: 600;">
                            ‚è±Ô∏è Sessions <span id="activityCountSession" style="opacity: 0.7; margin-left: 4px;">0</span>
                        </button>
                    </div>
                </div>
                <div id="devActivityLog"
                    style="background: var(--glass-bg); border-radius: 16px; border: 1px solid var(--glass-border); padding: 16px; max-height: 400px; overflow-y: auto;">
                    <div style="text-align: center; padding: 40px; color: var(--text-muted);">Loading activity...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory Tab (only visible when signed in) -->
    <div class="tab-content" id="tabInventory" style="display: none;">
        <div class="container">
            <div class="page-title">
                <h1>üì¶ My <span>Inventory</span></h1>
            </div>
            <p class="page-subtitle">Track your key fobs and key blanks in stock.</p>

            <div id="inventoryContent" style="margin-top: 24px;">
                <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
                    <div style="font-size: 4rem; margin-bottom: 16px;">üì¶</div>
                    <h3 style="color: var(--text-primary); margin-bottom: 8px;">Your inventory is empty</h3>
                    <p>Browse vehicles and add keys to your inventory to track stock.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Subscriptions Tab (only visible when signed in) -->
    <div class="tab-content" id="tabSubscriptions" style="display: none;">
        <div class="container">
            <div class="page-title">
                <h1>üìÖ Subscription <span>Tracker</span></h1>
            </div>
            <p class="page-subtitle">Track your tool subscriptions, licenses, and renewal dates in one place.</p>

            <!-- Alert Banner (populated by JS) -->
            <div id="subAlertBanner" style="display: none;"></div>

            <!-- Quick Stats -->
            <div class="sub-stats-row" id="subStatsRow">
                <div class="sub-stat-card">
                    <div class="sub-stat-number active" id="subActiveCount">0</div>
                    <div class="sub-stat-label">Active</div>
                </div>
                <div class="sub-stat-card">
                    <div class="sub-stat-number warning" id="subWarningCount">0</div>
                    <div class="sub-stat-label">Expiring Soon</div>
                </div>
                <div class="sub-stat-card">
                    <div class="sub-stat-number expired" id="subExpiredCount">0</div>
                    <div class="sub-stat-label">Expired</div>
                </div>
                <div class="sub-stat-card">
                    <div class="sub-stat-number lifetime" id="subLifetimeCount">0</div>
                    <div class="sub-stat-label">Lifetime</div>
                </div>
            </div>

            <!-- Add Subscription Button -->
            <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-bottom: 16px;">
                <button class="sub-add-btn" onclick="openAddSubscriptionModal()">
                    ‚ûï Add Subscription or License
                </button>
                <button class="sub-add-btn" style="background: linear-gradient(135deg, #10b981, #059669);"
                    onclick="manualAIAnalysis()">
                    ü§ñ AI Analysis
                </button>
            </div>

            <!-- Category Tabs -->
            <div class="sub-category-tabs" id="subCategoryTabs">
                <button class="sub-category-tab active" onclick="filterSubscriptions('all')">All</button>
                <button class="sub-category-tab" onclick="filterSubscriptions('key_programmer')">Key
                    Programmers</button>
                <button class="sub-category-tab" onclick="filterSubscriptions('diagnostic')">Diagnostics</button>
                <button class="sub-category-tab" onclick="filterSubscriptions('oem_dealer')">OEM Access</button>
                <button class="sub-category-tab" onclick="filterSubscriptions('software')">Software</button>
                <button class="sub-category-tab" onclick="filterSubscriptions('license')">Licenses</button>
                <button class="sub-category-tab" onclick="filterSubscriptions('insurance')">Insurance</button>
            </div>

            <!-- Subscription Cards Grid (populated by JS) -->
            <div class="sub-cards-grid" id="subCardsGrid">
                <!-- Empty state -->
                <div id="subEmptyState"
                    style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--text-muted);">
                    <div style="font-size: 4rem; margin-bottom: 16px;">üìã</div>
                    <h3 style="color: var(--text-primary); margin-bottom: 8px;">No subscriptions tracked yet</h3>
                    <p>Add your first subscription to start tracking renewal dates and costs.</p>
                </div>
            </div>

            <!-- License Section -->
            <div class="license-section" id="licenseSection">
                <h2 class="license-section-title">üìú Licenses & Certifications</h2>
                <div class="sub-cards-grid" id="licenseCardsGrid">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Subscription Modal -->
    <div class="sub-modal-overlay" id="subModalOverlay" style="display: none;" onclick="closeSubscriptionModal(event)">
        <div class="sub-modal" onclick="event.stopPropagation()">
            <div class="sub-modal-header">
                <h2 class="sub-modal-title" id="subModalTitle">Add Subscription</h2>
                <button class="sub-modal-close" onclick="closeSubscriptionModal()">√ó</button>
            </div>
            <div class="sub-modal-body">
                <div class="sub-form-group">
                    <label class="sub-form-label">Select from Catalog</label>
                    <select class="sub-form-select" id="subCatalogSelect" onchange="populateFromCatalog()">
                        <option value="">-- Choose a subscription --</option>
                        <optgroup label="Key Programmers">
                            <option value="autel_tcp">Autel TCP Subscription ($895/yr)</option>
                            <option value="lonsdor_update">Lonsdor K518 Update ($200/yr)</option>
                            <option value="xhorse_vvdi">Xhorse VVDI Subscription ($199/yr)</option>
                            <option value="obdstar_update">OBDStar Annual Update ($299/yr)</option>
                            <option value="xtool_x100">Xtool X100 PAD ($199/yr)</option>
                            <option value="advanced_diag">Advanced Diagnostics MVP Pro ($400/yr)</option>
                            <option value="key_tool_max">Xhorse Key Tool Max ($150/yr)</option>
                            <option value="keydiy_kd">KeyDIY KD-X2/KD-MAX ($99/yr)</option>
                        </optgroup>
                        <optgroup label="Diagnostic Tools">
                            <option value="autel_maxisys">Autel MaxiSys Update ($800/yr)</option>
                            <option value="launch_x431">Launch X431 Update ($299/yr)</option>
                            <option value="topdon_phoenix">TOPDON Phoenix Update ($399/yr)</option>
                            <option value="thinkdiag">ThinkDiag Pro ($99/yr)</option>
                            <option value="foxwell_gt90">Foxwell GT90 ($199/yr)</option>
                            <option value="autel_im508">Autel IM508 Update ($395/yr)</option>
                        </optgroup>
                        <optgroup label="OEM Dealer Access">
                            <option value="toyota_techstream">Toyota Techstream ($55/2-day)</option>
                            <option value="honda_hds">Honda HDS ($55/day)</option>
                            <option value="ford_fdrs">Ford FDRS ($40/day)</option>
                            <option value="fca_witech">FCA WiTech 2.0 ($100/day)</option>
                            <option value="gm_gds2">GM GDS2/Tech2Win ($50/day)</option>
                            <option value="nissan_consult">Nissan Consult III+ ($65/day)</option>
                            <option value="bmw_ista">BMW ISTA/D ($100/day)</option>
                            <option value="mb_xentry">Mercedes Xentry ($150/day)</option>
                            <option value="vw_odis">VW/Audi ODIS ($100/day)</option>
                            <option value="subaru_ssmiv">Subaru SSM IV ($65/day)</option>
                        </optgroup>
                        <optgroup label="Access Subscriptions">
                            <option value="nastf">NASTF Registration ($30/yr)</option>
                            <option value="autoauth">AutoAuth Access ($250/yr)</option>
                            <option value="key_comm">KEY-Comm ($150/yr)</option>
                            <option value="autel_immo">Autel MaxiIM Update ($895/yr)</option>
                        </optgroup>
                        <optgroup label="Software">
                            <option value="instacode">Instacode ($199/yr)</option>
                            <option value="keypro">Key-Pro ($249/yr)</option>
                            <option value="truecode">True-Code ($149/yr)</option>
                            <option value="jetlock">Jet Lock Tools ($99/yr)</option>
                            <option value="keyless_api">Keyless Entry API ($120/yr)</option>
                            <option value="lishi_decoder">Lishi Decoder App ($79/yr)</option>
                        </optgroup>
                        <optgroup label="Tokens (Per-Use)">
                            <option value="xhorse_mb_tokens">Xhorse MB Tokens</option>
                            <option value="autel_tokens">Autel Calculation Tokens</option>
                            <option value="lonsdor_jlr">Lonsdor JLR License ($180 one-time)</option>
                            <option value="yanhua_tokens">Yanhua ACDP Tokens</option>
                        </optgroup>
                        <optgroup label="Licenses & Certifications">
                            <option value="locksmith_license">Locksmith License (State)</option>
                            <option value="contractor_bond">Contractor Bond</option>
                            <option value="aloa_cert">ALOA Certification ($250/yr)</option>
                            <option value="cml_cert">CML Certification ($195/yr)</option>
                            <option value="savta_cert">SAVTA Certification ($150/yr)</option>
                        </optgroup>
                        <optgroup label="Insurance">
                            <option value="liability_insurance">General Liability Insurance</option>
                            <option value="eo_insurance">E&O Insurance</option>
                            <option value="auto_insurance">Commercial Auto Insurance</option>
                            <option value="workers_comp">Workers Compensation</option>
                        </optgroup>
                        <optgroup label="Other">
                            <option value="custom">Custom / Other</option>
                        </optgroup>
                    </select>
                </div>

                <div class="sub-form-group">
                    <label class="sub-form-label">Name</label>
                    <input type="text" class="sub-form-input" id="subName" placeholder="e.g., Autel TCP Subscription">
                </div>

                <div class="sub-form-group">
                    <label class="sub-form-label">Vendor</label>
                    <input type="text" class="sub-form-input" id="subVendor" placeholder="e.g., Autel">
                </div>

                <div class="sub-form-row">
                    <div class="sub-form-group">
                        <label class="sub-form-label">Cost</label>
                        <input type="number" class="sub-form-input" id="subCost" placeholder="895" min="0" step="0.01">
                    </div>
                    <div class="sub-form-group">
                        <label class="sub-form-label">Billing Cycle</label>
                        <select class="sub-form-select" id="subBillingCycle">
                            <option value="annual">Annual</option>
                            <option value="monthly">Monthly</option>
                            <option value="per_use">Per Use</option>
                            <option value="2day">2-Day Pass</option>
                            <option value="daily">Daily</option>
                            <option value="lifetime">Lifetime</option>
                        </select>
                    </div>
                </div>

                <div class="sub-form-row">
                    <div class="sub-form-group">
                        <label class="sub-form-label">Purchase Date</label>
                        <input type="date" class="sub-form-input" id="subPurchaseDate">
                    </div>
                    <div class="sub-form-group">
                        <label class="sub-form-label">Expiration Date</label>
                        <input type="date" class="sub-form-input" id="subExpirationDate">
                    </div>
                </div>

                <div class="sub-form-group">
                    <label class="sub-form-label">Category</label>
                    <select class="sub-form-select" id="subCategory">
                        <option value="key_programmer">Key Programmer</option>
                        <option value="diagnostic">Diagnostic Tool</option>
                        <option value="oem_dealer">OEM Dealer Access</option>
                        <option value="access">Access Subscription</option>
                        <option value="software">Software</option>
                        <option value="tokens">Tokens</option>
                        <option value="license">License / Certification</option>
                        <option value="insurance">Insurance</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="sub-form-group">
                    <label class="sub-form-label">Notes (Optional)</label>
                    <textarea class="sub-form-textarea" id="subNotes" rows="2"
                        placeholder="e.g., Required for Toyota 8A-BA server calculations"></textarea>
                </div>

                <div class="sub-form-group">
                    <label class="sub-form-label">Renewal URL (Optional)</label>
                    <input type="url" class="sub-form-input" id="subRenewalUrl" placeholder="https://...">
                </div>
            </div>
            <div class="sub-modal-footer">
                <button class="sub-btn-cancel" onclick="closeSubscriptionModal()">Cancel</button>
                <button class="sub-btn-save" onclick="saveSubscription()">Save Subscription</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        ¬© 2025 Euro Keys<br>
        Professional Automotive Locksmith - Richmond, VA
    </footer>

    <script>
    </script>

    <!-- Service Worker Registration for PWA with Auto-Update -->
    <!-- Programming Guide Modal -->
    <div id="guideModal" class="modal" style="display: none; align-items: center; justify-content: center;">
        <div class="modal-overlay" onclick="closeGuideModal()">
        </div>
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h2 id="guideModalTitle">
                    Programming
                    Guide
                </h2>
                <button class="modal-close" onclick="closeGuideModal()">√ó</button>
            </div>
            <div class="modal-body" id="guideModalBody" style="overflow-y: auto; padding: 20px; line-height: 1.6;">
                <!-- Content injected here -->
            </div>
        </div>
    </div>

    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
        data-cf-beacon='{"token": "55cb95cc0e174..."}'></script>
    <!-- End Cloudflare Web Analytics -->

    <!-- Core Logic -->
    <script src="js/config.js?v=1767214510"></script>
    <script src="js/errorhandler.js?v=1767214510"></script>
    <script src="js/ui.js?v=1767214510"></script>
    <script src="js/guides.js?v=1767214510"></script>
    <script src="js/browse.js?v=1767214510"></script>
    <script src="js/vin.js?v=1767214510"></script>
    <script src="js/fcc.js?v=1767214510"></script>
    <script src="js/inventory.js?v=1767214510"></script>
    <script src="js/auth.js?v=1767214510"></script>
    <script src="js/app.js?v=1767214510"></script>
    <script src="js/pwa.js?v=1767214510" defer></script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js?v=1767214510"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js?v=1767214510"></script>
    <script src="public/js/tool_coverage_data.js?v=1767214510"></script>
    <script src="public/js/programming_guides_data.js?v=1767214510"></script>
    <script src="public/js/transponder_reference.js?v=1767214510"></script>
    <script src="public/js/coverage_metadata.js?v=1767214510"></script>
    <!-- Dynamic Guide Renderer -->
    <script src="components/GuideRenderer.js?v=1767214510"></script>
</body>

</html>