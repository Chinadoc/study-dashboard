{
    "id": "mercedes-complete-guide",
    "title": "Mercedes-Benz Drive Authorization Systems Guide",
    "make": "Mercedes-Benz",
    "year_start": 2000,
    "year_end": 2025,
    "difficulty": "Expert",
    "estimated_time": "Varies by system",
    "last_updated": "2025-12-23",
    "source_pdf": "/guides/Mercedes_Locksmith_Codex.pdf",
    "modules": [
        {
            "type": "info_callout",
            "id": "mercedes-paradigm-shift",
            "level": "important",
            "content": "Mercedes requires a paradigm shift: You don't 'program' the car to accept the key. You extract the car's identity (SSID + Hash), calculate the secret Password, and synthesize a Key File that matches the car's pre-existing expectations."
        },
        {
            "type": "warning_banner",
            "id": "mercedes-fbs4-warning",
            "level": "critical",
            "content": "FBS4 (2015+): NO PUBLIC SOLUTION exists for calculating passwords or generating keys for DAS 4 / FBS4 vehicles. Must use dealer keys via Mercedes-Benz TRP program (requires NASTF VSP credentials)."
        },
        {
            "type": "reference_table",
            "id": "mercedes-das-evolution",
            "title": "Drive Authorization System Evolution",
            "headers": [
                "Generation",
                "Years",
                "Encryption",
                "Key Interface",
                "Locksmith Support"
            ],
            "rows": [
                {
                    "cells": [
                        "DAS 2a/2b",
                        "1995-1999",
                        "Basic",
                        "Flip Keys + PCF7935",
                        "Bench EEPROM only"
                    ],
                    "highlight": false
                },
                {
                    "cells": [
                        "DAS 3 / FBS3",
                        "2000-2014",
                        "SHA-1 Hash",
                        "Smart Key + IR + NEC MCU",
                        "Full aftermarket support"
                    ],
                    "highlight": true
                },
                {
                    "cells": [
                        "DAS 4 / FBS4",
                        "2014-Present",
                        "128-bit AES",
                        "Smart Key + IR",
                        "Dealer only"
                    ],
                    "highlight": true
                }
            ]
        },
        {
            "type": "info_callout",
            "id": "mercedes-ir-communication",
            "level": "note",
            "content": "Mercedes uses bidirectional Infrared (IR) communication, NOT the 125kHz LF coil used by Ford/Hyundai. The key battery powers ONLY the remote buttons. The ignition function is entirely induction-powered via the EIS."
        },
        {
            "type": "reference_table",
            "id": "mercedes-key-rail-architecture",
            "title": "Key Rail Architecture",
            "headers": [
                "Rail",
                "Segments",
                "Typical Use"
            ],
            "rows": [
                {
                    "cells": [
                        "Rail 1",
                        "3 versions",
                        "Original Key #1"
                    ]
                },
                {
                    "cells": [
                        "Rail 2",
                        "3 versions",
                        "Original Key #2"
                    ]
                },
                {
                    "cells": [
                        "Rails 3-8",
                        "3 versions each",
                        "Spare slots for locksmiths"
                    ]
                }
            ]
        },
        {
            "type": "warning_banner",
            "id": "mercedes-rail-conflict-warning",
            "level": "warning",
            "content": "You cannot have two keys on the same Rail simultaneously. If you program a new key to Rail 1, the old Key 1 stops working immediately. Always read EIS first to identify USED vs FREE rails, and write new keys to a FREE rail (e.g., Rail 3)."
        },
        {
            "type": "tool_checklist",
            "id": "mercedes-essential-tools",
            "title": "Mercedes Essential Tools",
            "items": [
                {
                    "name": "Xhorse VVDI MB BGA Tool",
                    "required": true,
                    "notes": "Industry standard - fastest password calculation (10-18 mins for W204)"
                },
                {
                    "name": "Autel IM608 Pro II + XP400 Pro + G-Box 3",
                    "required": false,
                    "notes": "Best all-in-one, G-Box MANDATORY for fast calc"
                },
                {
                    "name": "CGDI MB",
                    "required": false,
                    "notes": "Budget king - fastest server response, $10/month unlimited tokens"
                },
                {
                    "name": "Diagspeed",
                    "required": false,
                    "notes": "The 'Virginizing' specialist for ECU/TCU reset"
                },
                {
                    "name": "Lishi HU64",
                    "required": true,
                    "notes": "2-track high security for door entry"
                }
            ]
        },
        {
            "type": "step_group",
            "id": "mercedes-w204-add-key",
            "title": "Procedure: W204 C-Class Add Key (One Working Key)",
            "estimated_time": "20-30 mins",
            "steps": [
                {
                    "number": 1,
                    "text": "Connect IM608 to OBD-II"
                },
                {
                    "number": 2,
                    "text": "Select IMMO → Mercedes-Benz → Smart Selection → W204, verify DAS 3"
                },
                {
                    "number": 3,
                    "text": "Select 'Read EIS Data' - note SSID and which Key Rails are used"
                },
                {
                    "number": 4,
                    "text": "Select Password Calculation → Add Key (OBD)"
                },
                {
                    "number": 5,
                    "text": "Insert working key into EIS - tool reads hash"
                },
                {
                    "number": 6,
                    "text": "Insert working key into XP400 Programmer - tool reads IR data"
                },
                {
                    "number": 7,
                    "text": "Insert working key back into EIS - data acquisition takes 2-5 mins"
                },
                {
                    "number": 8,
                    "text": "Tool displays 16-digit hex Password - PHOTOGRAPH AND SAVE THIS"
                },
                {
                    "number": 9,
                    "text": "Select Generate Key File → Choose empty rail (e.g., Rail 3) → Format V51 (Half Key)"
                },
                {
                    "number": 10,
                    "text": "Insert blank BE Key into XP400 → Read & Write Key → IR → Write key file"
                },
                {
                    "number": 11,
                    "text": "Test: Insert new key, listen for ESL 'Zip-Click', turn to ON, verify start and remote"
                }
            ]
        },
        {
            "type": "step_group",
            "id": "mercedes-w204-akl",
            "title": "Procedure: W204 C-Class All Keys Lost",
            "estimated_time": "45 mins - 2 hours",
            "steps": [
                {
                    "number": 1,
                    "text": "Pick driver door using Lishi HU64 (2-track high security)",
                    "warning": "Pick direction is crucial. Alarm will sound."
                },
                {
                    "number": 2,
                    "text": "Silence alarm: Pop hood, disconnect horn or battery negative, wait 1 min"
                },
                {
                    "number": 3,
                    "text": "Connect 13.5V maintainer",
                    "warning": "CRITICAL: G-Box power-cycles EIS thousands of times, low voltage will corrupt flash"
                },
                {
                    "number": 4,
                    "text": "EIS Access - BENCH METHOD preferred over OBD for W204"
                },
                {
                    "number": 5,
                    "text": "Use W204 Bezel Tool to unscrew plastic ring around ignition"
                },
                {
                    "number": 6,
                    "text": "Push EIS into dash, reach from driver footwell, unplug connectors"
                },
                {
                    "number": 7,
                    "text": "Connect EIS to G-Box 3 using W204 Harness (DB15), supply 12V DC"
                },
                {
                    "number": 8,
                    "text": "Select Password Calculation → All Keys Lost → On Bench (G-Box)"
                },
                {
                    "number": 9,
                    "text": "G-Box rapidly clicks (relays switching) - 'glitching' processor to reveal hash"
                },
                {
                    "number": 10,
                    "text": "Wait 15-60 minutes for password display"
                },
                {
                    "number": 11,
                    "text": "Generate key file and write to blank key (same as Add Key)"
                },
                {
                    "number": 12,
                    "text": "Reinstall EIS. Insert new key, wait 5 sec, remove, insert again to hash with car"
                }
            ]
        },
        {
            "type": "info_callout",
            "id": "mercedes-gateway-cars",
            "level": "important",
            "content": "W164 ML/GL, W221 S-Class, W251 R-Class (2006-2013): The Central Gateway (ZGW/CGW) blocks OBD diagnostic traffic. You CANNOT perform AKL via OBD. Must use Gateway Bypass Adapter connecting directly to CAN-B/CAN-C bus of EIS."
        },
        {
            "type": "step_group",
            "id": "mercedes-esl-emulator-install",
            "title": "Procedure: ESL (Steering Lock) Emulator Installation",
            "estimated_time": "30-45 mins",
            "steps": [
                {
                    "number": 1,
                    "text": "Symptoms: Key turns, no dash lights, no crank, no steering unlock. Radio works."
                },
                {
                    "number": 2,
                    "text": "Scan EIS - if EIS status 'Normal' but ESL reports code A25464 or 'Component Fault' = ESL dead"
                },
                {
                    "number": 3,
                    "text": "Perform EIS Password Calculation (MUST have password to program emulator)"
                },
                {
                    "number": 4,
                    "text": "If ESL is locked: Drill 10mm hole through casing (use template), manually spin gear to retract bolt"
                },
                {
                    "number": 5,
                    "text": "Remove mounting bolt and unplug faulty ESL"
                },
                {
                    "number": 6,
                    "text": "Connect Emulator ($20-40) to tool via ESL menu"
                },
                {
                    "number": 7,
                    "text": "Load EIS Data and Password"
                },
                {
                    "number": 8,
                    "text": "Click 'Calculate Erase Password' to reset emulator"
                },
                {
                    "number": 9,
                    "text": "Click 'Personalize' - tool writes car-specific SSID and Hash List"
                },
                {
                    "number": 10,
                    "text": "Click 'Activate' - emulator married to EIS"
                },
                {
                    "number": 11,
                    "text": "Plug vehicle's 3-pin ESL connector into emulator, zip-tie under dash"
                },
                {
                    "number": 12,
                    "text": "Car believes steering is locked/unlocked instantly. Inform customer steering won't lock again (usually preferred)"
                }
            ]
        },
        {
            "type": "reference_table",
            "id": "mercedes-troubleshooting",
            "title": "Troubleshooting Matrix",
            "headers": [
                "Symptom",
                "Probable Cause",
                "Diagnostic/Fix"
            ],
            "rows": [
                {
                    "cells": [
                        "Key inserts, NO turn, NO dash lights",
                        "1. Dead Key Coil 2. ESL Failure (W204) 3. Dead Battery",
                        "Use coil detector on key. If coil lights but no turn = ESL. Check ESL for Fatal Error."
                    ]
                },
                {
                    "cells": [
                        "Key turns, NO crank",
                        "1. Gearshift not in P/N (ISM fault) 2. Starter Fuse/Relay 3. ECU Authorization missing",
                        "Check 'Actual Values' in EIS. Look for 'Start Enable: YES'. If EIS YES but ECU NO = variable code out of sync."
                    ]
                },
                {
                    "cells": [
                        "Key works, Remote does not",
                        "1. Wrong Frequency 2. Antenna Amp Fuse 3. Key battery dead",
                        "Check Fuse 8 in Rear SAM (W203/W211). Verify Key Frequency."
                    ]
                },
                {
                    "cells": [
                        "Password Calculation fails instantly",
                        "1. Wrong EIS Type selected 2. G-Box power connection loose",
                        "Double check connections. Ensure correct chassis/processor type selected."
                    ]
                },
                {
                    "cells": [
                        "Fan runs 100% (Jet engine mode)",
                        "ECU not authorized/communicating",
                        "Common sign of bad ECU or lost synchronization."
                    ]
                }
            ]
        },
        {
            "type": "info_callout",
            "id": "mercedes-frequency-trap",
            "level": "warning",
            "content": "Frequency Trap: 315 MHz = North America/Japan. 433 MHz = Europe/Rest of World. Imported grey market vehicles often have mismatched frequencies. Always read original key (if available) to verify frequency."
        },
        {
            "type": "reference_table",
            "id": "mercedes-key-sources",
            "title": "Key Shell and PCB Sources",
            "headers": [
                "Type",
                "Source",
                "Cost",
                "Notes"
            ],
            "rows": [
                {
                    "cells": [
                        "BE Keys (Aftermarket)",
                        "Xhorse, Keydiy, AliExpress",
                        "$12-20",
                        "Insert to Start only, not Keyless Go"
                    ]
                },
                {
                    "cells": [
                        "Keyless Go Keys",
                        "UHS Hardware, American Key Supply",
                        "$60-90",
                        "Hit-or-miss on W212/W221"
                    ]
                },
                {
                    "cells": [
                        "Dealer Keys (FBS4)",
                        "Mercedes TRP via NASTF VSP",
                        "$300+/year + per-key",
                        "Required for 2015+ vehicles"
                    ]
                }
            ]
        }
    ]
}