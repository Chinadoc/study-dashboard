<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <title>Euro Keys - Locksmith Database</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a1628;
            --bg-secondary: #111d32;
            --bg-tertiary: #1a2942;
            --brand-primary: #fbbf24;
            --brand-secondary: #f59e0b;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --success: #22c55e;
            --border: rgba(251, 191, 36, 0.15);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(180deg, var(--bg-primary) 0%, #0d1829 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Top Bar */
        .top-bar {
            background: var(--brand-primary);
            color: var(--bg-primary);
            text-align: center;
            padding: 10px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Header */
        .header {
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
        }

        .logo span {
            color: var(--brand-primary);
        }

        .header-right {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .header-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .header-avatar {
            width: 36px;
            height: 36px;
            background: var(--brand-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--bg-primary);
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: transparent;
            color: var(--text-secondary);
        }

        .tab:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--brand-primary);
            color: var(--bg-primary);
        }

        /* Container */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 24px;
        }

        /* Page Title */
        .page-title {
            text-align: center;
            margin-bottom: 12px;
        }

        .page-title h1 {
            font-size: 2.2rem;
            font-weight: 800;
        }

        .page-title h1 span {
            color: var(--brand-primary);
        }

        .page-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 32px;
            font-size: 1rem;
        }

        /* Browse Box */
        .browse-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            max-width: 700px;
            margin: 0 auto 40px;
        }

        .browse-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .browse-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .browse-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
        }

        .browse-select {
            padding: 16px 20px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
            cursor: pointer;
            appearance: none;
        }

        .browse-select:focus {
            outline: none;
            border-color: var(--brand-primary);
        }

        .search-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 18px;
            background: var(--brand-primary);
            border: none;
            border-radius: var(--radius);
            color: var(--bg-primary);
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
        }

        /* FCC Table */
        .fcc-search {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        /* FCC Filters */
        .fcc-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .fcc-filter {
            padding: 10px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 24px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .fcc-filter:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .fcc-filter.active {
            background: var(--brand-primary);
            color: var(--bg-primary);
            border-color: var(--brand-primary);
        }

        .fcc-search input {
            flex: 1;
            padding: 14px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 1rem;
        }

        .fcc-search input::placeholder {
            color: var(--text-muted);
        }

        .fcc-search input:focus {
            outline: none;
            border-color: var(--brand-primary);
        }

        .fcc-table-wrapper {
            overflow-x: auto;
        }

        .fcc-table {
            width: 100%;
            border-collapse: collapse;
        }

        .fcc-table th {
            text-align: left;
            padding: 14px 12px;
            background: var(--bg-secondary);
            color: var(--text-muted);
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border);
        }

        .fcc-table td {
            padding: 14px 12px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }

        .fcc-table tr:hover {
            background: var(--bg-secondary);
        }

        .fcc-link {
            color: var(--brand-primary);
            text-decoration: none;
            font-weight: 600;
        }

        .fcc-link:hover {
            text-decoration: underline;
        }

        .amazon-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #ff9900;
            color: #000;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
        }

        .amazon-btn:hover {
            background: #ffad33;
            transform: translateY(-1px);
        }

        /* Vehicle Card */
        .vehicle-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .vehicle-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .vehicle-name {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .vehicle-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-gold {
            background: var(--brand-primary);
            color: var(--bg-primary);
        }

        .badge-dark {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        /* Data Grid */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .data-item {
            padding: 14px;
            background: var(--bg-tertiary);
            border-radius: 10px;
        }

        .data-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .data-value {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .data-value a {
            color: var(--brand-primary);
            text-decoration: none;
        }

        .data-value.highlight {
            color: var(--brand-primary);
        }

        /* Views */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Results Section */
        .results-section {
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .result-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .back-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
            font-size: 0.85rem;
            border-top: 1px solid var(--border);
            margin-top: 60px;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px;
            color: var(--text-muted);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 24px;
        }

        .pagination button {
            padding: 10px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination .page-info {
            padding: 10px 16px;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .browse-grid {
                grid-template-columns: 1fr;
            }

            .data-grid {
                grid-template-columns: 1fr 1fr;
            }

            .page-title h1 {
                font-size: 1.6rem;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                font-size: 0.85rem;
                padding: 10px 16px;
            }
        }
    </style>
</head>

<body>

    <div class="top-bar">üìû Call (804) 506-0709</div>

    <header class="header">
        <div class="logo">üîë EURO <span>KEYS</span></div>
        <div class="header-right">
            <a href="#" class="header-link">Dashboard</a>
            <span class="header-link">üîç</span>
            <div class="header-avatar">JS</div>
        </div>
    </header>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab active" onclick="showTab('browse')">üìÇ Browse Database</button>
        <button class="tab" onclick="showTab('fcc')">üì° FCC Database</button>
    </div>

    <!-- Browse Database Tab -->
    <div class="tab-content active" id="tabBrowse">
        <div id="browseSection">
            <div class="container">
                <div class="page-title">
                    <h1>Browse <span>Database</span></h1>
                </div>
                <p class="page-subtitle">Select vehicle details to view locksmith specifications.</p>

                <div class="browse-box">
                    <div class="browse-grid">
                        <div class="browse-field">
                            <label class="browse-label">Year</label>
                            <select class="browse-select" id="yearSelect" onchange="loadMakes()">
                                <option value="">Select Year</option>
                            </select>
                        </div>
                        <div class="browse-field">
                            <label class="browse-label">Make</label>
                            <select class="browse-select" id="makeSelect" onchange="loadModels()">
                                <option value="">Select Make</option>
                            </select>
                        </div>
                        <div class="browse-field">
                            <label class="browse-label">Model</label>
                            <select class="browse-select" id="modelSelect">
                                <option value="">Select Model</option>
                            </select>
                        </div>
                    </div>
                    <button class="search-btn" onclick="searchVehicle()">Search Database üîç</button>
                </div>
            </div>
        </div>

        <div id="resultsSection" class="results-section">
            <div class="container">
                <div class="result-header">
                    <h2 class="result-title" id="resultTitle">Vehicle Results</h2>
                    <button class="back-btn" onclick="goBack()">‚Üê Back to Search</button>
                </div>
                <div id="resultsContainer"></div>
            </div>
        </div>
    </div>

    <!-- FCC Database Tab -->
    <div class="tab-content" id="tabFcc">
        <div class="container">
            <div class="page-title">
                <h1>FCC <span>Database</span></h1>
            </div>
            <p class="page-subtitle">Browse FCC IDs for key fobs and remotes with direct Amazon links.</p>

            <div class="fcc-filters">
                <button class="fcc-filter active" data-type="all" onclick="setFccFilter('all')">All Keys</button>
                <button class="fcc-filter" data-type="push" onclick="setFccFilter('push')">üöó Push-to-Start</button>
                <button class="fcc-filter" data-type="non-push" onclick="setFccFilter('non-push')">üîë Traditional
                    Key</button>
            </div>

            <div class="fcc-search">
                <input type="text" id="fccSearch" placeholder="üîç Search by FCC ID or vehicle..."
                    oninput="filterFccTable()">
            </div>

            <div class="fcc-table-wrapper">
                <table class="fcc-table">
                    <thead>
                        <tr>
                            <th>FCC ID</th>
                            <th>Vehicles</th>
                            <th>Frequency</th>
                            <th>Chip</th>
                            <th>Amazon</th>
                        </tr>
                    </thead>
                    <tbody id="fccTableBody">
                        <tr>
                            <td colspan="5" class="loading">Loading FCC data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="fccPagination"></div>
        </div>
    </div>

    <footer class="footer">
        ¬© 2025 Euro Keys<br>
        Professional Automotive Locksmith - Richmond, VA
    </footer>

    <script>
        const API = 'https://euro-keys.jeremy-samuels17.workers.dev';
        const AFFILIATE_TAG = 'eurokeys-20';

        // Valid makes only
        const VALID_MAKES = [
            'Acura', 'Alfa Romeo', 'Aston Martin', 'Audi', 'Bentley', 'BMW', 'Buick',
            'Cadillac', 'Chevrolet', 'Chrysler', 'Dodge', 'Ferrari', 'Fiat', 'Ford',
            'Genesis', 'GMC', 'Gmc', 'Honda', 'Hummer', 'Hyundai', 'Infiniti', 'Jaguar',
            'Jeep', 'Kia', 'Lamborghini', 'Land Rover', 'Lexus', 'Lincoln', 'Maserati',
            'Mazda', 'McLaren', 'Mercedes-Benz', 'Mercedes', 'Mercury', 'Mini',
            'Mitsubishi', 'Nissan', 'Oldsmobile', 'Pontiac', 'Porsche', 'Ram',
            'Rolls-Royce', 'Saab', 'Saturn', 'Scion', 'Subaru', 'Suzuki', 'Tesla',
            'Toyota', 'Volkswagen', 'Volvo'
        ];

        function isValidMake(make) {
            return VALID_MAKES.some(v => v.toLowerCase() === make.toLowerCase());
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach((t, i) => {
                t.classList.toggle('active', (tabName === 'browse' && i === 0) || (tabName === 'fcc' && i === 1));
            });
            document.getElementById('tabBrowse').classList.toggle('active', tabName === 'browse');
            document.getElementById('tabFcc').classList.toggle('active', tabName === 'fcc');

            if (tabName === 'fcc' && !fccDataLoaded) {
                loadFccData();
            }
        }

        // ================== BROWSE DATABASE ==================

        function populateYears() {
            const select = document.getElementById('yearSelect');
            const year = new Date().getFullYear() + 1;
            for (let y = year; y >= 2000; y--) {
                select.innerHTML += `<option value="${y}">${y}</option>`;
            }
        }

        async function loadMakes() {
            const year = document.getElementById('yearSelect').value;
            const select = document.getElementById('makeSelect');

            if (!year) {
                select.innerHTML = '<option value="">Select Make</option>';
                return;
            }

            select.innerHTML = '<option value="">Loading...</option>';

            try {
                const res = await fetch(`${API}/api/master?year=${year}&limit=1000`);
                const data = await res.json();
                const makes = [...new Set(data.rows.map(r => r.make))]
                    .filter(isValidMake)
                    .sort();

                select.innerHTML = '<option value="">Select Make</option>';
                makes.forEach(m => {
                    select.innerHTML += `<option value="${m}">${m}</option>`;
                });
            } catch (e) {
                select.innerHTML = '<option value="">Select Make</option>';
            }
        }

        async function loadModels() {
            const year = document.getElementById('yearSelect').value;
            const make = document.getElementById('makeSelect').value;
            const select = document.getElementById('modelSelect');

            if (!make) {
                select.innerHTML = '<option value="">Select Model</option>';
                return;
            }

            select.innerHTML = '<option value="">Loading...</option>';

            try {
                const res = await fetch(`${API}/api/master?year=${year}&make=${encodeURIComponent(make)}&limit=500`);
                const data = await res.json();
                const models = [...new Set(data.rows.map(r => r.model))].sort();

                select.innerHTML = '<option value="">Select Model</option>';
                models.forEach(m => {
                    select.innerHTML += `<option value="${m}">${m}</option>`;
                });
            } catch (e) {
                select.innerHTML = '<option value="">Select Model</option>';
            }
        }

        async function searchVehicle() {
            const year = document.getElementById('yearSelect').value;
            const make = document.getElementById('makeSelect').value;
            const model = document.getElementById('modelSelect').value;

            if (!year || !make || !model) {
                alert('Please select year, make, and model');
                return;
            }

            document.getElementById('resultTitle').textContent = `${year} ${make} ${model}`;
            document.getElementById('resultsContainer').innerHTML = '<div class="loading">Loading...</div>';

            document.getElementById('browseSection').style.display = 'none';
            document.getElementById('resultsSection').classList.add('active');

            try {
                const res = await fetch(`${API}/api/browse?year=${year}&make=${encodeURIComponent(make)}&model=${encodeURIComponent(model)}&limit=10`);
                const data = await res.json();

                if (data.rows && data.rows.length > 0) {
                    displayResults(data.rows, year, make, model);
                } else {
                    document.getElementById('resultsContainer').innerHTML = '<div class="loading">No results found</div>';
                }
            } catch (e) {
                document.getElementById('resultsContainer').innerHTML = '<div class="loading">Failed to load</div>';
            }
        }

        function displayResults(rows, year, make, model) {
            const container = document.getElementById('resultsContainer');

            container.innerHTML = rows.map(v => {
                const fccId = v.fcc_id || 'N/A';
                const fccLink = fccId !== 'N/A' ? `<a href="https://fccid.io/${fccId}" target="_blank">${fccId}</a>` : 'N/A';
                const amazonLink = fccId !== 'N/A' ? getAmazonLink(fccId) : null;
                const immo = v.immobilizer_system || v.immobilizer || 'N/A';
                const chip = v.chip || v.chip_technology || 'N/A';
                const freq = v.frequency ? `${v.frequency} MHz` : 'N/A';
                const keyway = v.keyway || 'N/A';
                const buttons = v.buttons || 'N/A';
                const battery = v.battery || 'N/A';
                const oem = v.oem_part_number || 'N/A';

                return `
                <div class="vehicle-card">
                    <div class="vehicle-card-header">
                        <div class="vehicle-name">${year} ${make} ${model}</div>
                        <div class="vehicle-badges">
                            <span class="badge badge-gold">${immo !== 'N/A' ? immo : 'Standard'}</span>
                            ${amazonLink ? `<a href="${amazonLink}" target="_blank" class="amazon-btn">üõí Buy on Amazon</a>` : ''}
                        </div>
                    </div>
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">FCC ID</div>
                            <div class="data-value highlight">${fccLink}</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Immobilizer</div>
                            <div class="data-value">${immo}</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Chip</div>
                            <div class="data-value">${chip}</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Frequency</div>
                            <div class="data-value">${freq}</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Key Blank</div>
                            <div class="data-value">${keyway}</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Buttons</div>
                            <div class="data-value">${buttons}</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Battery</div>
                            <div class="data-value">${battery}</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">OEM Part #</div>
                            <div class="data-value">${oem}</div>
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        function goBack() {
            document.getElementById('browseSection').style.display = 'block';
            document.getElementById('resultsSection').classList.remove('active');
        }

        // ================== FCC DATABASE ==================

        let fccData = [];
        let fccDataLoaded = false;
        let fccPage = 1;
        let fccKeyType = 'all'; // 'all', 'push', 'non-push'
        const FCC_PER_PAGE = 20;

        // Determine if FCC ID is for a push-to-start key
        function isPushKey(row) {
            const vehicles = (row.vehicles || '').toLowerCase();
            const chip = (row.chip || '').toLowerCase();
            const freq = parseFloat(row.frequency) || 0;

            // Push keys typically: 433 MHz, prox/PEPS systems, modern chips
            const pushIndicators = ['peps', 'prox', 'smart key', 'push', 'intelligent key', 'keyless'];
            const pushChips = ['id47', 'id49', 'id4a', 'hitag pro', 'hitag-aes', 'hitag 3'];

            // Check for push indicators in vehicle/chip names
            const hasPushKeyword = pushIndicators.some(kw => vehicles.includes(kw) || chip.includes(kw));
            const hasPushChip = pushChips.some(c => chip.includes(c));

            // 433 MHz is commonly used for proximity keys
            const is433MHz = freq >= 433;

            return hasPushKeyword || hasPushChip || is433MHz;
        }

        function setFccFilter(type) {
            fccKeyType = type;
            fccPage = 1;
            // Update active button
            document.querySelectorAll('.fcc-filter').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === type);
            });
            renderFccTable();
        }

        async function loadFccData() {
            try {
                const res = await fetch(`${API}/api/fcc?limit=500`);
                const data = await res.json();
                fccData = data.rows || [];
                fccDataLoaded = true;
                renderFccTable();
            } catch (e) {
                document.getElementById('fccTableBody').innerHTML = '<tr><td colspan="5" class="loading">Failed to load FCC data</td></tr>';
            }
        }

        function filterFccTable() {
            fccPage = 1;
            renderFccTable();
        }

        function renderFccTable() {
            const search = document.getElementById('fccSearch').value.toLowerCase();

            let filtered = fccData.filter(r =>
                (r.fcc_id || '').toLowerCase().includes(search) ||
                (r.vehicles || '').toLowerCase().includes(search)
            );

            // Apply key type filter
            if (fccKeyType === 'push') {
                filtered = filtered.filter(isPushKey);
            } else if (fccKeyType === 'non-push') {
                filtered = filtered.filter(r => !isPushKey(r));
            }

            const totalPages = Math.ceil(filtered.length / FCC_PER_PAGE);
            const start = (fccPage - 1) * FCC_PER_PAGE;
            const pageData = filtered.slice(start, start + FCC_PER_PAGE);

            const tbody = document.getElementById('fccTableBody');

            if (pageData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="loading">No FCC IDs found</td></tr>';
                return;
            }

            tbody.innerHTML = pageData.map(r => {
                const fccId = r.fcc_id || 'N/A';
                const vehicles = r.vehicles || 'N/A';
                const freq = r.frequency || 'N/A';
                const chip = r.chip || 'N/A';
                const amazonLink = getAmazonLink(fccId);

                // Format vehicles list - show first 2, then count
                const vehicleList = vehicles !== 'N/A' ? vehicles.split(',').slice(0, 2).join(', ') : 'N/A';
                const vehicleCount = vehicles !== 'N/A' ? vehicles.split(',').length : 0;
                const vehicleDisplay = vehicleCount > 2 ? `${vehicleList} +${vehicleCount - 2} more` : vehicleList;

                return `
                <tr>
                    <td><a href="https://fccid.io/${fccId}" target="_blank" class="fcc-link">${fccId}</a></td>
                    <td style="max-width: 300px; font-size: 0.85rem;">${vehicleDisplay}</td>
                    <td>${freq}${freq !== 'N/A' && !String(freq).includes('Hz') ? ' MHz' : ''}</td>
                    <td>${chip}</td>
                    <td><a href="${amazonLink}" target="_blank" class="amazon-btn">üõí Amazon</a></td>
                </tr>
            `;
            }).join('');

            // Pagination
            document.getElementById('fccPagination').innerHTML = `
            <button onclick="fccPrev()" ${fccPage === 1 ? 'disabled' : ''}>‚Üê Prev</button>
            <span class="page-info">Page ${fccPage} of ${totalPages} (${filtered.length} results)</span>
            <button onclick="fccNext()" ${fccPage >= totalPages ? 'disabled' : ''}>Next ‚Üí</button>
        `;
        }

        function fccPrev() {
            if (fccPage > 1) {
                fccPage--;
                renderFccTable();
            }
        }

        function fccNext() {
            fccPage++;
            renderFccTable();
        }

        // ================== AMAZON AFFILIATE LINK ==================

        function getAmazonLink(fccId) {
            // Create Amazon search URL with affiliate tag
            const searchTerm = encodeURIComponent(`${fccId} key fob remote`);
            return `https://www.amazon.com/s?k=${searchTerm}&tag=${AFFILIATE_TAG}`;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', populateYears);
    </script>
</body>

</html>